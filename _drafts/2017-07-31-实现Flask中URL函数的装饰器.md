---
layout: post
title: "实现Flask中URL函数的装饰器"
category: Python
tags: [Flask, decorator]
date: 2017-07-31
---



下面的代码是不work的：

```python
@check_cookie
@app.route('/')
def hello_world():
    return 'hello world'
```

必须把`@app.route`装饰器放在最上面，即最外层。（why？）





下面的代码会报错：

```python
from flask import Flask, request, Response, redirect
import time

app = Flask(__name__)

def check_cookie(func):
    def wrapper():
        if not request.cookies:
            return redirect('/login')
        else:
            func()
    return wrapper

@app.route('/')
@check_cookie
def hello_world():
    return 'hello world'

@app.route('/show')
@check_cookie
def show():
    return request.cookies.__str__()
```

错误提示为：

```
AssertionError: View function mapping is overwriting an existing endpoint function: wrapper
```



正确的做法是，仅仅需要在`check_cookie`方法中添加一行代码就可以了（how？）：

```python
def check_cookie(func):
    @wraps(func)
    def wrapper():
        if not request.cookies:
            return redirect('/login')
        else:
            func()
    return wrapper
```

